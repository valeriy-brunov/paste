## Paste плагин для CakePHP.

### Что может этот плагин?

Вставляет внутрь себя при помощи AJAX-запроса HTML-код. Поддерживает разные режимы вставки и ожидания получения HTML-кода.

### Установка

Вы можете установить этот плагин в свое приложение CakePHP с помощью [composer](https://getcomposer.org).

Рекомендуемый способ установки пакетов composer - это:

```
composer require valeriy-brunov/paste
composer dumpautoload
bin/cake plugin load Paste
```

Для удаления плагина используйте команду:

```
composer remove valeriy-brunov/paste --update-with-dependencies
```

### Как работает плагин.

Классическая схема работы плагина: после загрузки плагина на странице, из атрибута `url` извлекается адрес, по которому производится AJAX-запрос. При ожидании вставки HTML-кода показывается прелоадер (труббер). После получения HTML-кода от AJAX-запроса, прелоадер скрывается.

Для реализации различных вариантов использование этого плагина применяют настройки.

### Настройка.

Для настройки необходимо указать его опцию `[options]` в виде массива:

```php
echo $this->Webcomp->paste([options]);
```

Указанные в массиве `options` преобразуются в атрибуты веб-компонента.

* `url` - Содержит адрес AJAX-запроса, который сработает сразу после появления веб-компонента на странице. При изменение адреса этого атрибута происходит повторный AJAX-запрос. Для режима `firstLoad = html` атрибут `url` указывать не нужно. В этом случае, вместо адреса запроса туда будет подставлен символ `#` (решётка).

Режимы загрузки представлены двумя атрибутами, которые будут содержать вид загрузки:

* `firstLoad` - Вид загрузки, который необходимо применить при первоначальной загрузке страницы;
* `nextLoad`  - Вид загрузки, который необходимо применить при изменение атрибута `url`.

Далее перечислим значения, которые могут принимать атрибуты `firstLoad` и `nextLoad`. Вид загрузки показывает, что увидит пользователь ожидающий AJAX-загрузку HTML-кода или при первой загрузке страницы. При указание следующего вида загрузки пользователь увидит:

* `loader`   - Прелоадер (труббер);
* `progress` - Прогресс-бар. Содержимое веб-компонента остаётся не тронутым до тех пор пока прогресс-бар не достигнет 100%, после чего прогресс-бар исчезает и происходит замена HTML-кода.
* `progress-loader` - Прелоадер (труббер) и прогресс-бар;
* `html` - HTML-код.

Перечисленные виды загрузок для режима `nextLoad` можно менять динамически, т.е. при одном изменение атрибута `url` можно показать прелоадер (труббер), а при следующем изменение можно изменить вид загрузки и увидеть помимо труббера ещё и прогресс-бар.

Вёрстка, которая будет размещена внутри веб-компонента должна быть свёрстана по определённым правилам, а именно:

+ Прелоадер (труббер) должен иметь класс `paste__trubber`;
+ Прогресс-бар, расположенный внутри веб-компонента `paste` должен иметь класс `paste__progress`;
+ Прогресс-бар, расположенный за пределами веб-компонента `paste`, должен иметь атрибут `id`;
+ Оболочка контента должна иметь класс `paste__replace`.

> :memo: Если вы планируете использовать вид загрузки `progress-loader` или `loader`, то необходимо помимо вёрстки прелоадера (труббера) и прогресс-бара использовать заглушку с классом `paste__replace`, иначе пришедшему от `AJAX`-запроса `html`-коду нечего будет заменять.

И ещё один необязательный атрибут:

+ `progressId` - Если прогресс-бар необходимо разместить за пределами веб-компонента `paste`, то необходимо передать в этой настройке `id` прогресс-бара.

Пример веб-компонента `paste` с добавлением внутренней вёрстки:

```php
<?php $this->start('paste') ?>
    <div class="paste__progress">...</div>
    <div class="paste__trubber">...</div>
    <div class="paste__replace"></div>// Заглушка.
<?php $this->end() ?>
<?php echo
    $this->Webcomp->paste([
        'url' => '/gotovo/index/test4',
        'firstLoad' => 'progress-loader',
        'nextLoad' => 'progress-loader',
        'progressId' => 'my-progress-bar',
    ]);
?>
```